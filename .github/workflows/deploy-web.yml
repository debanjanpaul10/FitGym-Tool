name: Deploy FitGymTool Web UI

env:
    WEB_PROJECT_PATH: FitGymTool.UI

on:
    push:
        branches:
            - main
        paths:
            - "FitGymTool.UI/**"
            - ".github/workflows/deploy-web.yml"
    pull_request:
        branches:
            - main
        types:
            - closed
        paths:
            - "FitGymTool.UI/**"
            - ".github/workflows/deploy-web.yml"
    workflow_dispatch:

jobs:
    build-and-deploy-web:
        name: "Build and Deploy FitGymTool.UI"
        if: ${{ (github.event_name == 'push' && github.ref == 'refs/heads/main') || (github.event_name == 'pull_request' && github.event.pull_request.merged == true) || github.event_name == 'workflow_dispatch' }}
        runs-on: ubuntu-latest
        environment: Production

        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Set up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "22.x"

            - name: Install dependencies and build UI
              run: |
                  cd ${{ env.WEB_PROJECT_PATH }}
                  npm install
                  npm run build

            - name: Deploy UI to Azure Web App
              uses: Azure/static-web-apps-deploy@v1
              with:
                  azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_TOKEN }}
                  action: "upload"
                  app_location: ${{ env.WEB_PROJECT_PATH }}
                  output_location: "dist/FitGymTool.UI/browser"
              env:
                  NODE_VERSION: "22"
